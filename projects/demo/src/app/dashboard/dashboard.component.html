<!-- Dashboard principal que ocupa el espacio disponible menos el nav -->
<div class="container dashboard-container pb-4">
  <!-- Dashboard con nuevo layout -->
  <div class="dashboard">
    <!-- GrÃ¡ficos secundarios - se reparten el ancho en partes iguales -->
    <div class="secondary-charts">
      <!-- GrÃ¡fico secundario 1 -->
      <div class="element one">
        <div class="chart">
          <libChart
            #chartOne
            [dataset]="datasetOne"
            [chartOptions]="chartOptionsOne"
          ></libChart>
        </div>
        <p class="text-center my-1 text-muted">CondiciÃ³n</p>
      </div>

      <!-- GrÃ¡fico secundario 2 -->
      <div class="element two">
        <div class="chart">
          <libChart
            #chartTwo
            [dataset]="datasetTwo"
            [chartOptions]="chartOptionsTwo"
          ></libChart>
        </div>
        <p class="text-center my-1 text-muted">Sector de gestiÃ³n</p>
      </div>

      <!-- GrÃ¡fico secundario 3 -->
      <div class="element three">
        <div class="chart">
          <libChart
            #chartThree
            [dataset]="datasetThree"
            [chartOptions]="chartOptionsThree"
          ></libChart>
        </div>
        <p class="text-center my-1 text-muted">Sexo</p>
      </div>
    </div>

    <!-- GrÃ¡fico principal - ocupa todo el ancho -->
    <div class="element four">
      <libChart
        #chartFull
        [dataset]="datasetFour"
        [chartOptions]="chartOptionsFour"
      ></libChart>
    </div>

    <!-- Tabla principal - ocupa todo el ancho -->
    <div class="element five">
      <libTable
        #tableFull
        [dataset]="datasetFour"
        [tableOptions]="tableOptions"
      ></libTable>
    </div>
  </div>
</div>

<!-- Panel lateral deslizante para controles adicionales -->
<div class="side-menu shadow-lg" [class.open]="isSidePanelOpen">
  <!-- BotÃ³n para cerrar el panel -->
  <div
    class="close-button"
    (click)="closeSidePanel()"
    (keydown.enter)="closeSidePanel()"
    (keydown.space)="closeSidePanel()"
    tabindex="0"
    role="button"
    aria-label="Cerrar panel"
  >
    <span>&times;</span>
  </div>

  <div class="side-menu-content">
    <!-- TÃ­tulo del panel -->
    <h3 class="side-menu-title">ConfiguraciÃ³n Avanzada</h3>

    <!-- SecciÃ³n de filtros avanzados -->
    <div class="filter-section my-4">
      <h4>Filtros</h4>

      <!-- IteraciÃ³n sobre dimensiones para filtrado avanzado -->
      @for (dimension of dimensions; track dimension.id) {
        <div class="filter-group">
          <!-- Cabecera de dimensiÃ³n -->
          <div class="dimension-header">
            <div class="form-check">
              <label
                class="form-check-label"
                [for]="'dimension' + dimension.id"
              >
                {{ dimension.nameView }}
              </label>
            </div>

            <!-- BotÃ³n para expandir/colapsar -->
            <button
              class="toggle-button"
              (click)="toggleDimensionItems(dimension)"
              type="button"
            >
              <span
                [innerHTML]="
                  isDimensionCollapsed(dimension.id.toString()) ? 'â†’' : 'â†“'
                "
              ></span>
            </button>
          </div>

          <!-- Lista de items de la dimensiÃ³n -->
          <div
            class="dimension-items"
            [class.collapsed]="isDimensionCollapsed(dimension.id.toString())"
          >
            <!-- OpciÃ³n "Todos" -->
            <div class="form-check ms-4">
              <input
                type="checkbox"
                class="form-check-input"
                #allCheckbox
                [checked]="areAllItemsSelected(dimension)"
                [id]="'all' + dimension.id"
                (change)="
                  toggleAllItems(dimension, $any($event.target).checked)
                "
              />
              <label
                class="form-check-label fw-bold"
                [for]="'all' + dimension.id"
              >
                Todos
              </label>
            </div>

            <!-- Items individuales -->
            @for (item of dimension.items; track item.id) {
              <div class="form-check ms-4">
                <input
                  type="checkbox"
                  class="form-check-input"
                  [(ngModel)]="item.selected"
                  [id]="'item' + item.id"
                  (ngModelChange)="onItemChange()"
                />
                <label class="form-check-label" [for]="'item' + item.id">
                  {{ item.name }}
                </label>
              </div>
            }
          </div>
        </div>
      }

      <!-- BotÃ³n para resetear filtros -->
      <button class="action-btn reset-btn w-100" (click)="clearFilters()">
        <span class="action-icon">ðŸ”„</span>
        <span class="action-text">Reestablecer filtros</span>
      </button>
    </div>
  </div>
</div>

<!-- BotÃ³n flotante para abrir el panel lateral -->
<!-- Solo se muestra cuando el panel estÃ¡ cerrado -->
<button
  class="floating-menu-button"
  (click)="toggleSidePanel()"
  *ngIf="!isSidePanelOpen"
>
  <span>â˜°</span>
</button>
