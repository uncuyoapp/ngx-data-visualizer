<!-- Contenedor principal de la demo con ejemplos de uso de la librerÃ­a ngx-data-visualizer -->
<div class="my-5 pb-4">
  <h1 class="mb-4">Ejemplo de uso de <code>ngx-data-visualizer</code></h1>

  <!-- SecciÃ³n de grÃ¡fico simple - Muestra cÃ³mo usar el componente libChart -->
  <div class="chart my-4 shadow p-2 p-md-4 rounded">
    <h2 class="text-center">GrÃ¡fico</h2>
    <!--
      libChart: Componente principal para mostrar grÃ¡ficos
      - dataset: Contiene los datos y configuraciÃ³n de dimensiones
      - chartOptions: ConfiguraciÃ³n visual del grÃ¡fico
      - seriesChange: Evento que se dispara cuando cambian las series del grÃ¡fico
    -->
    <libChart #chartOne="libChart" [dataset]="dataset" [chartOptions]="chartOptions"
      (seriesChange)="onSeriesChange($event)">
    </libChart>
  </div>

  <!-- SecciÃ³n de tabla - Muestra cÃ³mo usar el componente libTable -->
  <div class="my-4 shadow p-2 p-md-4 rounded">
    <h2 class="text-center">Tabla</h2>
    <div class="table">
      <!--
        libTable: Componente para mostrar datos en formato tabular
        - dataset: Los mismos datos que usa el grÃ¡fico
        - tableOptions: ConfiguraciÃ³n especÃ­fica para la tabla
      -->
      <libTable #tableOne="libTable" [dataset]="dataset" [tableOptions]="tableOptions"></libTable>
    </div>
  </div>

  <!-- SecciÃ³n de grÃ¡ficos mÃºltiples - Muestra cÃ³mo dividir datos en mÃºltiples grÃ¡ficos -->
  <div class="my-4 shadow p-2 p-md-4 rounded">
    <h2 class="text-center">GrÃ¡ficos mÃºltiples - {{ splitDimension.nameView }}</h2>
    <div class="multiChart">
      <!--
        libMultipleChart: Componente para generar mÃºltiples grÃ¡ficos basados en una dimensiÃ³n
        - dataset: Datos fuente
        - options: ConfiguraciÃ³n de grÃ¡ficos
        - splitDimension: DimensiÃ³n por la cual dividir los datos
      -->
      <libMultipleChart [dataset]="dataset" [options]="chartOptions" [splitDimension]="splitDimension">
      </libMultipleChart>
    </div>
  </div>
</div>

<!-- Panel lateral deslizante para controles de filtros y acciones -->
<!-- Se abre/cierra con animaciones CSS mediante la clase 'open' -->
<div class="side-menu shadow p-4" [class.open]="isSidePanelOpen">

  <!-- BotÃ³n para cerrar el panel desde dentro -->
  <div class="close-button" (click)="closeSidePanel()" (keyup.enter)="closeSidePanel()" tabindex="0" role="button" aria-label="Cerrar panel lateral">
    <span>&times;</span>
  </div>

  <div class="actions">
    <!-- SecciÃ³n de filtrado y agrupamiento de dimensiones -->
    <div class="dimensions my-4">
      <h3>Filtrado y agrupamiento</h3>

      <div class="actions-list">
        <!-- IteraciÃ³n sobre todas las dimensiones del dataset -->
        @for (dimension of dataset.dimensions; track dimension.id) {
        <div class="action">

          <!-- Cabecera de cada dimensiÃ³n con checkbox y botÃ³n de colapso -->
          <div class="dimension-header">
            <div class="checkboxlabel">
              <!-- Checkbox para habilitar/deshabilitar dimensiÃ³n completa -->
              <!-- ValidaciÃ³n: al menos una dimensiÃ³n debe estar activa -->
              <input color="zero" type="checkbox" class="checkbox" [(ngModel)]="dimension.selected"
                (ngModelChange)="onDimensionChange(dimension)" [id]="'dimension' + dimension.id" />
              <label [for]="'dimension' + dimension.id">{{
                dimension.nameView
                }}</label>
            </div>

            <!-- BotÃ³n para expandir/colapsar items de la dimensiÃ³n -->
            <button class="toggle-button" (click)="toggleDimensionItems(dimension)" type="button">
              <span [innerHTML]="isDimensionCollapsed(dimension.id.toString()) ? 'â†’' : 'â†“'"></span>
            </button>
          </div>

          <!-- Lista de items de cada dimensiÃ³n (colapsable) -->
          <div class="actions-list" [class.collapsed]="isDimensionCollapsed(dimension.id.toString())" style="padding-right: 0px">

            <!-- OpciÃ³n "Todos" - controla todos los items de la dimensiÃ³n -->
            <div class="action action-item">
              <div class="checkboxlabel">
                <!--
                  Checkbox "Todos" con estado inteligente:
                  - Checked: cuando todos los items estÃ¡n seleccionados
                  - Indeterminado: cuando algunos items estÃ¡n seleccionados
                  - Unchecked: cuando ningÃºn item estÃ¡ seleccionado
                -->
                <input type="checkbox" class="checkbox"
                       #allCheckbox
                       [checked]="areAllItemsSelected(dimension)"
                       [id]="'alls' + dimension.id"
                       (change)="toggleAllItems(dimension, $any($event.target).checked)" />
                <label [for]="'alls' + dimension.id">Todos</label>
              </div>
            </div>

            <!-- Items individuales de cada dimensiÃ³n -->
            @for (item of dimension.items; track item.id) {
            <div class="action action-item">
              <div class="checkboxlabel">
                <!-- Checkbox individual para cada item -->
                <input type="checkbox" class="checkbox" [(ngModel)]="item.selected" [id]="'item' + item.id"
                  (ngModelChange)="onItemChange()" />
                <label [for]="'item' + item.id">{{ item.name }}</label>
              </div>
            </div>
            }
          </div>
        </div>
        }
      </div>

      <!-- BotÃ³n para resetear todos los filtros a su estado inicial -->
      <button class="action-btn reset-btn w-100" (click)="clearFilters()">
        <span class="action-icon">ðŸ”„</span>
        <span class="action-text">Reestablecer filtros</span>
      </button>
    </div>

    <!-- SecciÃ³n de configuraciÃ³n de grÃ¡ficos mÃºltiples -->
    <div class="my-4">
      <h3>GrÃ¡ficos mÃºltiples</h3>
      <div class="multiple-charts-config">
        <label for="splitDimensionSelect">Dividir por dimensiÃ³n:</label>
        <select
          id="splitDimensionSelect"
          class="form-select"
          [value]="splitDimension.id"
          (change)="onSplitDimensionChange($any($event.target).value)"
        >
          @for (dimension of dataset.dimensions; track dimension.id) {
            <option [value]="dimension.id">{{ dimension.nameView }}</option>
          }
        </select>
      </div>
    </div>

    <!-- SecciÃ³n de acciones sobre los componentes de visualizaciÃ³n -->
    <div class="my-4">
      <h3>Acciones</h3>
      <div class="actions-buttons">

        <!-- Toggle vista porcentual/nominal -->
        <button class="action-btn" [class.active]="isPercentViewActive" (click)="togglePercentView(chartOne)">
          <span class="action-icon">ðŸ“Š</span>
          <span class="action-text">{{ isPercentViewActive ? 'Vista nominal' : 'Vista porcentual' }}</span>
        </button>

        <!-- Toggle mostrar/ocultar meta -->
        <button class="action-btn" [class.active]="isGoalVisible" (click)="toggleGoal(chartOne)">
          <span class="action-icon">ðŸŽ¯</span>
          <span class="action-text">{{ isGoalVisible ? 'Ocultar meta' : 'Mostrar meta' }}</span>
        </button>
      </div>
    </div>

    <!-- SecciÃ³n de descargas -->
    <div class="my-4">
      <h3>Descargas</h3>
      <div class="actions-buttons">

        <!-- Exportar el grÃ¡fico como imagen -->
        <button class="action-btn" (click)="exportChart(chartOne)">
          <span class="action-icon">ðŸ“ˆ</span>
          <span class="action-text">Descargar grÃ¡fico</span>
        </button>

        <!-- Exportar los datos de la tabla como Excel -->
        <button class="action-btn" (click)="exportTable(tableOne)">
          <span class="action-icon">ðŸ“‹</span>
          <span class="action-text">Descargar tabla</span>
        </button>
      </div>
    </div>

  </div>
</div>

<!-- BotÃ³n flotante para abrir el panel lateral -->
<!-- Solo se muestra cuando el panel estÃ¡ cerrado -->
<button class="floating-menu-button" (click)="toggleSidePanel()" *ngIf="!isSidePanelOpen">
  <span>â˜°</span>
</button>
