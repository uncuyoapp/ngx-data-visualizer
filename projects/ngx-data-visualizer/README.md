# @uncuyoapp/ngx-data-visualizer

[![NPM Version](https://badge.fury.io/js/%40uncuyoapp%2Fngx-data-visualizer.svg)](https://www.npmjs.com/package/@uncuyoapp/ngx-data-visualizer)
[![Demo](https://img.shields.io/badge/Demo-Live-brightgreen.svg)](https://uncuyoapp.github.io/ngx-data-visualizer/)
[![Angular](https://img.shields.io/badge/Angular-18+-red.svg)](https://angular.io)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

> **Nota:** Esta es la documentaci√≥n t√©cnica de la librer√≠a. Para una gu√≠a de instalaci√≥n, configuraci√≥n y ejemplos de uso, consulta el [README principal](https://github.com/uncuyoapp/ngx-data-visualizer/blob/main/README.md) o la [demo interactiva](https://uncuyoapp.github.io/ngx-data-visualizer/).

`@uncuyoapp/ngx-data-visualizer` es una librer√≠a de c√≥digo abierto desarrollada por el **√Årea de Pol√≠ticas P√∫blicas de la Universidad Nacional de Cuyo**. Su objetivo es facilitar la visualizaci√≥n de datos en proyectos Angular, promoviendo el uso de herramientas tecnol√≥gicas para el an√°lisis de datos p√∫blicos.

La librer√≠a proporciona un conjunto de directivas `standalone` para la visualizaci√≥n de datos mediante gr√°ficos y tablas interactivas.

## ‚ú® Caracter√≠sticas principales

- **üöÄ Standalone Architecture** - Completamente compatible con Angular standalone APIs
- **‚öôÔ∏è Proveedores configurables** - Incluye solo las funcionalidades que necesitas
- **üìä Visualizaciones potentes** - Integraci√≥n con ECharts y PivotTable.js
- **üé® Altamente personalizable** - Temas y estilos configurables
- **üì§ Exportaci√≥n m√∫ltiple** - Soporta SVG, PNG, JPG, Excel y HTML
- **üîß TypeScript completo** - Interfaces tipadas para mejor experiencia de desarrollo
- **üì± Responsive** - Optimizado para dispositivos m√≥viles y desktop
- **üéØ Filtros avanzados** - Sistema de filtrado y agrupaci√≥n integrado

## üìÅ Estructura de la Librer√≠a

La estructura del c√≥digo fuente en `projects/ngx-data-visualizer/src/lib` est√° organizada por funcionalidad:

```
/src/lib/
‚îú‚îÄ‚îÄ chart/               # L√≥gica principal para gr√°ficos (ChartComponent)
‚îú‚îÄ‚îÄ table/               # L√≥gica principal para tablas (TableComponent)
‚îú‚îÄ‚îÄ multiple-chart/      # Componente para m√∫ltiples gr√°ficos
‚îú‚îÄ‚îÄ directives/          # Directivas standalone (chart, table, multiple-chart)
‚îú‚îÄ‚îÄ services/            # Servicios principales (Dataset, DataProvider)
‚îú‚îÄ‚îÄ providers.ts         # Proveedores de servicios para la inyecci√≥n de dependencias
‚îú‚îÄ‚îÄ icons/               # Componentes de √≠conos SVG
‚îú‚îÄ‚îÄ legend/              # Componente de leyenda para gr√°ficos
‚îî‚îÄ‚îÄ types/               # Interfaces y tipos de datos globales
```

## üìñ Uso en Componentes

Una vez instalada y configurada seg√∫n el [README principal](https://github.com/uncuyoapp/ngx-data-visualizer/blob/main/README.md), puedes usar las directivas en cualquier componente standalone:

```ts
// my-component.component.ts
import { Component } from '@angular/core';
import { 
  ChartDirective, 
  TableDirective,
  Dataset,
  ChartOptions,
  TableOptions,
  Dimension,
  RowData
} from '@uncuyoapp/ngx-data-visualizer';

@Component({
  selector: 'app-my-component',
  standalone: true,
  imports: [
    ChartDirective, // ‚úÖ Importa las directivas que necesites
    TableDirective
  ],
  template: `
    <!-- Gr√°fico -->
    <div libChart 
         [dataset]="dataset" 
         [chartOptions]="chartOptions"
         (seriesChange)="onSeriesChange($event)">
    </div>

    <!-- Tabla -->
    <div libTable 
         [dataset]="dataset" 
         [tableOptions]="tableOptions">
    </div>
  `
})
export class MyComponent {
  // Configuraci√≥n de datos
  dimensions: Dimension[] = [
    {
      id: 1,
      name: 'region',
      nameView: 'Regi√≥n',
      items: [
        { id: 1, name: 'Norte', selected: true },
        { id: 2, name: 'Sur', selected: true },
        { id: 3, name: 'Este', selected: true },
        { id: 4, name: 'Oeste', selected: true },
      ],
    },
    {
      id: 2,
      name: 'periodo',
      nameView: 'Per√≠odo',
      items: [
        { id: 10, name: '2023', selected: true },
        { id: 11, name: '2024', selected: true },
      ],
    },
  ];

  rowData: RowData[] = [
    { region: 'Norte', periodo: '2023', valor: 1500 },
    { region: 'Sur', periodo: '2023', valor: 1200 },
    { region: 'Este', periodo: '2023', valor: 1800 },
    { region: 'Oeste', periodo: '2023', valor: 1600 },
    { region: 'Norte', periodo: '2024', valor: 1400 },
    { region: 'Sur', periodo: '2024', valor: 1100 },
    { region: 'Este', periodo: '2024', valor: 1900 },
    { region: 'Oeste', periodo: '2024', valor: 1700 },
  ];

  dataset = new Dataset({
    dimensions: this.dimensions,
    rowData: this.rowData,
    enableRollUp: true,
  });

  chartOptions: ChartOptions = {
    type: 'bar',
    stacked: 'region',
    xAxis: {
      title: '',
      rotateLabels: null,
      firstLevel: 2,
      secondLevel: null,
    },
    yAxis: {
      title: '',
      max: null,
    },
    tooltip: {
      shared: true,
      decimals: null,
      suffix: null,
      format: null,
      showTotal: false,
    },
    legends: {
      enabled: false,
      show: false,
      position: '',
    },
    navigator: {
      show: false,
      start: null,
      end: null,
    },
    width: 600,
    height: 400,
    filterLastYear: false,
    showYearsLegend: false,
    toPercent: false,
    measureUnit: '',
    isPreview: false,
    disableAutoUpdate: false,
  };

  tableOptions: TableOptions = {
    digitsAfterDecimal: 0,
    sorters: [],
    totalRow: false,
    totalCol: false,
    cols: [1],
    rows: [2],
  };

  onSeriesChange(series: any[]): void {
    console.log('Series actualizadas:', series);
  }
}
```

## üß© API de Directivas

### ChartDirective

Directiva para renderizar gr√°ficos individuales.

#### Inputs

| Propiedad | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `dataset` | `Dataset` | ‚úÖ **Requerido** - Conjunto de datos a visualizar |
| `chartOptions` | `ChartOptions` | ‚úÖ **Requerido** - Configuraci√≥n del gr√°fico |

#### Outputs

| Evento | Tipo | Descripci√≥n |
|--------|------|-------------|
| `seriesChange` | `Series[]` | Se emite cuando cambian las series del gr√°fico |

#### M√©todos p√∫blicos

```ts
@ViewChild(ChartDirective) chartDirective!: ChartDirective;

// Cambiar a vista porcentual
this.chartDirective.toPercentage();

// Exportar gr√°fico
const svgData = this.chartDirective.export('svg');
this.chartDirective.export('jpg'); // Descarga autom√°tica

// Mostrar/ocultar l√≠nea de meta
this.chartDirective.toggleShowGoal(goalConfig);
```

### TableDirective

Directiva para renderizar tablas din√°micas e interactivas.

#### Inputs

| Propiedad | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `dataset` | `Dataset` | ‚úÖ **Requerido** - Conjunto de datos a visualizar |
| `tableOptions` | `TableOptions` | ‚úÖ **Requerido** - Configuraci√≥n de la tabla |

#### M√©todos p√∫blicos

```ts
@ViewChild(TableDirective) tableDirective!: TableDirective;

// Cambiar modo de visualizaci√≥n
this.tableDirective.setValueDisplay('percentOfTotal');
this.tableDirective.setValueDisplay('percentOfRow');
this.tableDirective.setValueDisplay('percentOfColumn');
this.tableDirective.setValueDisplay('nominal');

// Exportar tabla
this.tableDirective.export('xlsx', 'mi-tabla');
const htmlData = this.tableDirective.export('html');
```

### MultipleChartDirective

Directiva para renderizar m√∫ltiples gr√°ficos simult√°neamente.

#### Inputs

| Propiedad | Tipo | Descripci√≥n |
|-----------|------|-------------|
| `dataset` | `Dataset` | ‚úÖ **Requerido** - Conjunto de datos a visualizar |
| `options` | `ChartOptions` | ‚úÖ **Requerido** - Configuraci√≥n base de los gr√°ficos |
| `splitDimension` | `Dimension` | ‚úÖ **Requerido** - Dimensi√≥n a partir de la cu√°l se generar√°n m√∫ltiples |

## üìä Configuraci√≥n de Datos

### Dataset

La clase `Dataset` es el n√∫cleo de la visualizaci√≥n de datos. Gestiona los datos, dimensiones y filtros.

```ts
import { Dataset, Dimension, RowData } from '@uncuyoapp/ngx-data-visualizer';

const dataset = new Dataset({
  id: 1,                    // Opcional - Identificador √∫nico
  dimensions: dimensions,   // ‚úÖ Requerido - Definici√≥n de dimensiones
  rowData: rowData,        // ‚úÖ Requerido - Datos en formato tabular
  enableRollUp: true       // Opcional - Habilita agrupaciones
});
```

### Dimension

Define las categor√≠as de datos disponibles:

```ts
const dimension: Dimension = {
  id: 1,                    // Identificador √∫nico
  name: 'region',          // Clave en los datos
  nameView: 'Regi√≥n',      // Nombre para mostrar
  selected: true,          // Si est√° seleccionada por defecto
  enableMulti: true,       // Permite desagregar en multiples gr√°ficos
  items: [                 // Valores posibles
    {
      id: 1,
      name: 'Norte',
      selected: true,
      color: '#ff0000',    // Color opcional
      order: 1             // Orden opcional
    }
  ]
};
```

### ChartOptions

Configuraci√≥n completa para gr√°ficos.

```ts
interface ChartOptions {
  /** Tipo de gr√°fico (ej: 'column', 'line', 'pie', etc.) */
  type: string;
  /** T√≠tulo del gr√°fico */
  title?: string;
  /** Indica si el gr√°fico est√° apilado y el valor debe corresponder al nombre de una de las dimensiones del conjunto de datos */
  stacked: string | null;
  /** Configuraci√≥n del eje X */
  xAxis: {
    /** T√≠tulo del eje X */
    title: string,
    /** √Ångulo de rotaci√≥n de las etiquetas en grados */
    rotateLabels: number | null,
    /** Nivel de agrupaci√≥n primario (id de una de las dimensiones del conjunto de datos) */
    firstLevel: number,
    /** Nivel de agrupaci√≥n secundario (id de una de las dimensiones del conjunto de datos) (opcional) */
    secondLevel: number | null
  },
  /** Configuraci√≥n del eje Y */
  yAxis: {
    /** T√≠tulo del eje Y */
    title: string,
    /** Valor m√°ximo del eje Y */
    max: number | null
  },
  /** Configuraci√≥n del tooltip */
  tooltip: {
    /** Indica si el tooltip es compartido entre series */
    shared: boolean,
    /** N√∫mero de decimales a mostrar */
    decimals: number | null,
    /** Sufijo para los valores */
    suffix: string | null,
    /** Formato personalizado para los valores */
    format: string | null,
    /** Indica si se muestra el total en el tooltip */
    showTotal: boolean
  },
  /** Configuraci√≥n de las leyendas */
  legends: {
    /** Indica si las leyendas est√°n habilitadas */
    enabled: boolean,
    /** Indica si se muestran las leyendas */
    show: boolean,
    /** Posici√≥n de las leyendas */
    position: string
  },
  /** Configuraci√≥n del navegador */
  navigator: {
    /** Indica si se muestra el navegador */
    show: boolean,
    /** Valor inicial del navegador */
    start: number | null,
    /** Valor final del navegador */
    end: number | null
  },
  /** Array de colores personalizados para las series */
  colors?: string[],
  /** Ancho del gr√°fico */
  width: number | null,
  /** Alto del gr√°fico */
  height: number | string | null,
  /** Indica si se filtra el √∫ltimo a√±o */
  filterLastYear: boolean,
  /** Indica si se muestra la leyenda de a√±os */
  showYearsLegend: boolean,
  /** Indica si los valores se muestran en porcentaje */
  toPercent: boolean,
  /** Unidad de medida para los valores */
  measureUnit: string;
  /** Indica si el gr√°fico est√° en modo vista previa */
  isPreview: boolean;
  /** Indica si se deshabilita la actualizaci√≥n autom√°tica */
  disableAutoUpdate: boolean;
}
```

### TableOptions

Configuraci√≥n para tablas.

```ts
interface TableOptions {
  /** N√∫mero de decimales a mostrar */
  digitsAfterDecimal: number;
  /** Configuraci√≥n de ordenamiento para cada dimensi√≥n */
  sorters: TableSorter[];
  /** Indica si se debe mostrar la fila de totales */
  totalRow: boolean;
  /** Indica si se debe mostrar la columna de totales */
  totalCol: boolean;
  /** Lista de nombres o IDs de columnas */
  cols: (string | number)[];
  /** Lista de nombres o IDs de filas */
  rows: (string | number)[];
  /** Sufijo opcional para los valores num√©ricos */
  suffix?: string;
  /** Define el modo de visualizaci√≥n de los valores en la tabla */
  valueDisplay?:
    | "nominal"
    | "percentOfTotal"
    | "percentOfRow"
    | "percentOfColumn";
}

/**
* Interfaz para la configuraci√≥n del ordenamiento de dimensiones
*/
interface TableSorter {
  /** Nombre o ID de la dimensi√≥n a ordenar */
  name: string | number;
  /** Lista de √≠tems con su orden espec√≠fico */
  items: {
    /** Nombre del √≠tem */
    name: string;
    /** Orden del √≠tem */
    order: number;
  }[];
}
```

## üé® Filtros y Agrupaciones

### Aplicar filtros

```ts
import { FiltersConfig } from '@uncuyoapp/ngx-data-visualizer';

// Configuraci√≥n de filtros
const filtersConfig: FiltersConfig = {
  // Agrupar por dimensiones (rollUp)
  rollUp: [1], // Agrupa por la dimensi√≥n con id 1
  
  // Filtrar valores espec√≠ficos
  filter: [
    {
      name: 2,              // ID de dimensi√≥n
      items: ['2024']       // Valores a incluir
    }
  ]
};

// Aplicar al dataset
dataset.applyFilters(filtersConfig);

// Limpiar todos los filtros
dataset.applyFilters({});
```

### Escuchar cambios

```ts
// Suscribirse a cambios en los datos
dataset.dataUpdated.subscribe(() => {
  console.log('Datos actualizados');
  console.log(dataset.getCurrentData());
});
```


## üì§ Exportaci√≥n de Datos

### Gr√°ficos

```ts
// SVG (vector, escalable)
const svgData = chartDirective.export('svg');

// JPG (imagen, descarga autom√°tica)
chartDirective.export('jpg');
```

### Tablas

```ts
// Excel (descarga autom√°tica)
tableDirective.export('xlsx', 'mi-reporte');

// HTML (retorna string)
const htmlTable = tableDirective.export('html');
```

## üöÄ Optimizaci√≥n y Rendimiento

### Lazy Loading

Los proveedores de la librer√≠a (`provideDataVisualizerCharts` y `provideDataVisualizerTables`) ya implementan carga diferida (lazy loading) de forma autom√°tica para dependencias pesadas como ECharts y PivotTable.js.

### Tree Shaking

La librer√≠a est√° optimizada para tree shaking. Para asegurar un tama√±o de bundle m√≠nimo, importa solo los componentes y clases que necesites.

```ts
// ‚úÖ Bueno - Solo importa lo necesario
import { ChartDirective, Dataset } from '@uncuyoapp/ngx-data-visualizer';

// ‚ùå Evita - Importa todo el namespace
import * as NgxDataVisualizer from '@uncuyoapp/ngx-data-visualizer';
```

### Gesti√≥n de memoria

Es una buena pr√°ctica desuscribirse de los observables para evitar fugas de memoria.

```ts
export class MyComponent implements OnDestroy {
  private subscription?: Subscription;
  
  ngOnInit(): void {
    this.subscription = this.dataset.dataUpdated.subscribe(/* ... */);
  }
  
  ngOnDestroy(): void {
    this.subscription?.unsubscribe();
  }
}
```

## üìö Ejemplos Adicionales

Para ejemplos completos y casos de uso avanzados, consulta:

- **Demo interactiva**: [Ver ejemplos en vivo](https://uncuyoapp.github.io/ngx-data-visualizer/)
- **Gu√≠a de instalaci√≥n**: [README principal](https://github.com/uncuyoapp/ngx-data-visualizer/blob/main/README.md)
- **Repositorio**: [GitHub - @uncuyoapp/ngx-data-visualizer](https://github.com/uncuyoapp/ngx-data-visualizer)


## üìÑ Licencia

MIT License. Ver [LICENSE](https://github.com/uncuyoapp/ngx-data-visualizer/blob/main/LICENSE) para detalles completos.

---

**Desarrollado con ‚ù§Ô∏è por el [√Årea de Pol√≠ticas P√∫blicas](https://www.uncuyo.edu.ar/politicaspublicas/) - Universidad Nacional de Cuyo**
